# LEARNINGS

<!--VERSION_INFO_START-->
Current Version: v0.21.57 (synced 2025-10-08T08:27:30.366Z)
<!--VERSION_INFO_END-->

Updated (UTC): 2025-09-27T10:12:29.071Z

- 2025-10-01T11:20:06.000Z — Public health payload enriched (status/version/app/db/TTL users/chain subset); admin routes emit structured logs on token; safe by default.
- 2025-10-01T11:20:06.000Z — Read-only chain endpoints added (block/tx/balance) with validation and no-store; provider failover/pinning reused; no new deps.
- 2025-10-01T11:20:06.000Z — Deployment governed via GitHub-only policy; vercel.json treated as legacy; no Vercel ops by AI.

- Process: Repository structure places Next.js app under frontend/. Ensure all file operations and documentation paths reflect this to avoid confusion and miswrites.
- Dev: Timestamp enforcement — standardized on new Date().toISOString() for scripts and docs to guarantee ISO 8601 with milliseconds (UTC).
- 2025-09-27T10:12:29.071Z — Build from repo root failed initially due to missing root package.json. Fixed by creating a minimal root package.json that delegates dev/build/start to ./frontend using `npm -C`. Rationale: reuse existing Next app; minimal, non-invasive.
- 2025-09-27T10:12:29.071Z — Next.js warned about inferred workspace root (multiple lockfiles). Fixed by setting `turbopack.root = process.cwd()` in frontend/next.config.mjs to silence the warning reliably under ESM.
- 2025-09-27T10:12:29.071Z — JSX parse error in admin/health page (`items=[...]`). Fixed by using `items={[...]}` to pass an array expression as a prop.
- 2025-09-27T10:41:02.404Z — Duplicate homepage detected (app/page.js and app/page.jsx both mapped to "/"). Resolved by removing app/page.js and keeping app/page.jsx which implements the functional landing page. Rationale: avoid ambiguity and align with current app logic.
- 2025-09-27T10:46:40.975Z — Health API initially required a legacy Mongo env key while .env.local used MONGODB_URI. Interim fix accepted both to unblock development.
- 2025-09-30T11:16:01.000Z — Standardized on MONGODB_URI; removed legacy fallback to eliminate ambiguity across environments.
- 2025-09-27T12:18:29.407Z — Improved UI states: added loading/success/warning/error visuals. StatusCard now supports variant styling; homepage presents friendly status instead of raw JSON. Rationale: immediate clarity on whether the system is healthy and where issues exist.
- 2025-09-30T11:16:01.000Z — Standardized on MONGODB_URI (legacy fallback removed). Rationale: single-source configuration across local and Vercel; clearer onboarding and error messages.
- 2025-10-08T07:28:33.000Z — Fixed 3D mesh triangle subdivision failure on 11th click. Root causes: (1) Fragile API response parsing that failed when polygon coordinates were nested; (2) Sequential async operations causing race conditions; (3) Material color hardcoded instead of using computed status colors; (4) API base URL pointing to production server instead of localhost. Solution: (a) Added robust `parseChildrenResponse`, `parsePolygonResponse`, and `ringToVertices` helpers with defensive validation; (b) Refactored `subdivideTriangle` to use functional state updates and `Promise.all` for concurrent polygon fetches; (c) Added re-entry guards and comprehensive ISO 8601 timestamped logging; (d) Fixed material to use computed color for visual feedback; (e) Updated `.env.local` to use `http://localhost:5500`. Outcome: Subdivision now works reliably, parent disappears atomically, 4 children appear correctly, and nested subdivisions function as expected. Prevention: Always use functional state updates with React hooks; validate nested API responses with explicit type checks; use Promise.all for concurrent I/O operations; provide structured logging with timestamps for debugging async flows; verify environment variables point to correct endpoints.
- 2025-10-08T08:20:49.000Z — Removed stroke system and implemented progressive color feedback instead. Root cause: Tube geometry strokes caused performance issues, z-fighting artifacts, and complexity in camera-distance scaling that didn't work reliably across all zoom levels. Decision: Simplify by using color progression alone for visual feedback. Solution: Replaced status-based colors with progressive 11-step gradient from first click (0→11): Clicks 0=#1a1a1a (dark gray), 1-3=gray gradient, 4-6=gray→yellow, 7-9=yellow→orange, 10=#ff3300 (bright orange), 11=#00ff00 (green subdividing), subdivided=#0066ff (blue). Removed all stroke/edge rendering code including curvedEdges, strokeColor, camera distance tracking, inset calculations, and tube geometry. Outcome: Clean, simple visual progression showing mining progress through color alone; improved performance by removing ~180 lines of stroke code and 3 tube meshes per triangle; no more z-fighting or scaling issues. Rationale: Color-based feedback is simpler, more performant, and provides clear visual progression without geometric complexity.
